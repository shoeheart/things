<p id="notice"><%= notice %></p>

<h1>Animals</h1>

<%#
  use data-* method of firing a link on first page load
  to populate dashboard after page initially loads.
  Subsequent use of "add animal" form on this page
  will use Rails.ajax call directly to replace the contents of
  dashboard-totals div with latest counts
%>

<div id="dashboard-totals"><%=
  link_to "dashboard loading...",
  url_for( {controller: "animals", action: "totals"} ),
  method: :patch,
  remote: true,
  id: "dashboard-link"
%></div>
<%#
  Note that below click will only work first time page is loaded.
  Subsequent turbolinks loads will already have replaced the dashboard-totals
  with the actual dashboard, so the link will be gone.  Fix is
  that whenever the js fires to populate dashboard-totals, must
  also remove the javascript tag from the html.
%>
<%= javascript_tag '
dashboardLink = $("a#dashboard-link")[0]
if ( dashboardLink ) {
  dashboardLink.click(); 
}', id: "initial-dashboard-clicker-script" %>
<hr/>
<% if write_animals? %>
  <%= form_with( model: @animal, html: { id: 'add_animal_form' } ) do |f| %>
    <%= f.label :name %>: <%= f.text_field :name %>
    <%= f.label :species_id, "Species" %>: <%=
      f.collection_select(
        :species_id,
        @species,
        :id,
        :name
      )
    %>
    <%= f.label :birth_date %>: <%= f.date_field :birth_date %>
    <%= f.label :is_vaccinated %>: <%= f.check_box :is_vaccinated %>
    <%= f.label :image %>: <%= f.file_field :image, direct_upload: true %>
    <%= f.submit "Add Animal", data: { remote: true, disable: true, disable_with: "Adding..." } %>
  <% end %>
<% end %>
<hr/>

<table class="table">
  <thead class="thead-light">
    <tr>
      <th>Name</th>
      <th>Species</th>
      <th>Toy Count</th>
      <% if write_animals? %>
      <th>Actions</th>
      <% end %>
    </tr>
  </thead>

  <tbody id="animals">
    <%= render @animals %>
  </tbody>
</table>

<%
=begin
%>
<%= link_to 'New Animal', new_animal_path, class: "btn btn-primary" %>
<br/>
<a href="#" onclick="this.style.backgroundColor='#990000'; return false;">Paint it red</a>
<br/>
<a href="#" data-background-color="#990000">Paint it red</a>
<a href="#" data-background-color="#009900" data-text-color="#FFFFFF">Paint it green</a>
<a href="#" data-background-color="#000099" data-text-color="#FFFFFF">Paint it blue</a>

<hr/>
<%
=end
%>

